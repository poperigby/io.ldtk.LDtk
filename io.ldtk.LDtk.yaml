app-id: io.ldtk.LDtk
runtime: org.freedesktop.Sdk
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.ocaml
command: simple.sh
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
build-options:
  append-path: /app/share/runtime/ocaml/bin:/app/share/runtime/ocaml/switch/_opam/bin:/usr/lib/sdk/ocaml/bin
  env:
    CAML_LD_LIBRARY_PATH: /app/share/runtime/ocaml/switch/_opam/lib/stublibs:/app/share/runtime/ocaml/switch/_opam/lib/ocaml/stublibs:/app/share/runtime/ocaml/switch/_opam/lib/ocaml
    OCAML_TOPLEVEL_PATH: /app/share/runtime/ocaml/switch/_opam/lib/toplevel
    OPAMROOT: /app/share/runtime/ocaml
    OPAMSWITCH: /app/share/runtime/ocaml/switch
    OPAM_SWITCH_PREFIX: /app/share/runtime/ocaml/switch/_opam
modules:
  - shared-modules/gtk2/gtk2.json
  - name: apache
    sources:
      - type: archive
        url: https://dlcdn.apache.org/httpd/httpd-2.4.58.tar.gz
        sha256: 503a7da4a4a27fd496037998b17078dc9fe004db32c657c96cce8356b8aa2eb6
      - type: archive
        url: https://dlcdn.apache.org//apr/apr-1.7.4.tar.gz
        sha256: a4137dd82a185076fa50ba54232d920a17c6469c30b0876569e1c2a05ff311d9
  - name: mariadb
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/MariaDB/server/archive/refs/tags/mariadb-11.2.2.tar.gz
        sha256: 5b2da54aff64ab3463b0358181919b45ce78cd16b470e1558ee3a8fc1064086d
      - type: archive
        url: https://github.com/mariadb-corporation/mariadb-connector-c/archive/refs/tags/v3.1.23.tar.gz
        sha256: bd99e82420563324775477844c673e26a9e858adbd431435b2b888264795be8d
  - name: boehm-gc
    sources:
      - type: archive
        url: https://www.hboehm.info/gc/gc_source/gc-8.2.4.tar.gz
        sha256: 3d0d3cdbe077403d3106bb40f0cbb563413d6efdbb2a7e1cd6886595dec48fc2
  - name: neko
    buildsystem: cmake
    sources:
      - type: archive
        url: https://github.com/HaxeFoundation/neko/archive/refs/tags/v2-3-0.tar.gz
        sha256: 850e7e317bdaf24ed652efeff89c1cb21380ca19f20e68a296c84f6bad4ee995
  - name: pcre2
    sources:
      - type: archive
        url: https://github.com/PCRE2Project/pcre2/archive/refs/tags/pcre2-10.42.tar.gz
        sha256: a8e52a9bd1bca8f51c5c24823adc2a99acb12288e289a6507090c1a4a4815010
  - name: zlib
    sources:
      - type: git
        url: https://github.com/madler/zlib.git
        branch: v1.2.11
  # - name: switch
  #   buildsystem: simple
  #   sources:
  #     - type: git
  #       branch: master
  #       url: https://github.com/ocaml/opam-repository
  #     - type: archive
  #       url: https://github.com/ocaml/ocaml/archive/refs/tags/4.14.0.tar.gz
  #       dest: switch
  #       sha256: 39f44260382f28d1054c5f9d8bf4753cb7ad64027da792f7938344544da155e8
  #   build-commands:
  #     - mkdir -p ${FLATPAK_DEST}/share/runtime/ocaml
  #     - mv switch ${FLATPAK_DEST}/share/runtime/ocaml
  #     - opam init -y --bare --disable-sandboxing .
  #     - opam switch create -y --deps-only ${FLATPAK_DEST}/share/runtime/ocaml/switch
  #     - opam pin -y ${FLATPAK_DEST}/share/runtime/ocaml/switch
  #   post-install:
  #     - opam switch list
  # # Manifest code generated by flatpak-opam-generator
  # - name: haxe
  #   buildsystem: simple
  #   sources:
  #     - haxe.json
  #     - type: git
  #       branch: master
  #       url: https://github.com/ocaml/opam-repository
  #   build-commands:
  #     - ls -A --color=never | grep -Ev "cache|packages|repo" | xargs rm -rf
  #     - opam admin filter -y haxe.4.1.1 camlp5.8.02.01 bos.0.2.1 astring.0.8.5 ocamlbuild.0.14.2 ocamlfind.1.9.6 topkg.1.0.7 fmt.0.9.0 fpath.0.7.3 logs.0.7.0 rresult.0.7.0 camlp-streams.5.0.1 dune.3.11.1 camlp5-buildscripts.0.03 not-ocamlfind.0.12 ocamlgraph.2.1.0 stdlib-shims.0.3.0 re.1.11.0 extlib.1.7.7-1 cppo.1.6.9 ptmap.2.0.5 sedlex.3.2 gen.1.1 ppxlib.0.31.0 ocaml-compiler-libs.v0.12.4 ppx_derivers.1.2.1 sexplib0.v0.16.0 sha.1.15.4 xml-light.2.5
  #     - opam admin cache
  #     - opam repo add haxe .
  #     - opam install -y haxe.4.1.1 camlp5.8.02.01 bos.0.2.1 astring.0.8.5 ocamlbuild.0.14.2 ocamlfind.1.9.6 topkg.1.0.7 fmt.0.9.0 fpath.0.7.3 logs.0.7.0 rresult.0.7.0 camlp-streams.5.0.1 dune.3.11.1 camlp5-buildscripts.0.03 not-ocamlfind.0.12 ocamlgraph.2.1.0 stdlib-shims.0.3.0 re.1.11.0 extlib.1.7.7-1 cppo.1.6.9 ptmap.2.0.5 sedlex.3.2 gen.1.1 ppxlib.0.31.0 ocaml-compiler-libs.v0.12.4 ppx_derivers.1.2.1 sexplib0.v0.16.0 sha.1.15.4 xml-light.2.5
  #     - opam repo remove --all haxe
  #   post-install:
  #     - opam info --field name,all-installed-versions haxe
  # - name: ldtk
  #   buildsystem: simple
  #   build-options:
  #     env:
  #       XDG_CACHE_HOME: /run/build/ldtk/flatpak-node/cache
  #       npm_config_cache: /run/build/ldtk/flatpak-node/npm-cache
  #       npm_config_offline: 'true'
  #   build-commands:
  #     # Install npm dependencies
  #     - npm install --offline
  #     # Build the app; in this example the `dist` script
  #     # in package.json runs electron-builder
  #     - |
  #       . ../flatpak-node/electron-builder-arch-args.sh
  #       npm run dist -- $ELECTRON_BUILDER_ARCH_ARGS  --linux --dir
  #     # Bundle app and dependencies
  #     - cp -a dist/linux*unpacked /app/main
  #     # Install app wrapper
  #     - install -Dm755 -t /app/bin/ ../run.sh
  #   subdir: main
  #   sources:
  #     #- type: archive
  #     #  url: https://github.com/flathub/ldtk/archive/1.0.1.tar.gz
  #     #  sha256: a2feb3f1cf002a2e4e8900f718cc5c54db4ad174e48bfcfbddcd588c7b716d5b
  #     - type: dir
  #       path: ..
  #       dest: main
  #     - generated-sources.json
  #     # Wrapper to launch the app
  #     - type: script
  #       dest-filename: run.sh
  #       commands:
  #         - zypak-wrapper.sh /app/main/ldtk "$@"
